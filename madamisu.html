<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ¼ãƒ€ãƒ¼ãƒŸã‚¹ãƒ†ãƒªãƒ¼ - ã‚¯ãƒªãƒ ã‚¾ãƒ³ãƒ»ãƒãƒ³ã‚·ãƒ§ãƒ³äº‹ä»¶</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d1810 100%);
            color: #f0f0f0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(139, 0, 0, 0.3);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 2.5em;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            margin-bottom: 10px;
        }

        .game-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .timer {
            font-size: 1.5em;
            color: #ff6b6b;
            font-weight: bold;
        }

        .phase {
            font-size: 1.2em;
            color: #FFD700;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .players-panel, .info-panel {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #8B0000;
        }

        .center-panel {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #8B0000;
        }

        .player-card {
            background: rgba(139, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid #FFD700;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .player-card:hover {
            background: rgba(139, 0, 0, 0.4);
            transform: translateY(-2px);
        }

        .player-card.selected {
            border-color: #ff6b6b;
            background: rgba(255, 107, 107, 0.2);
        }

        .player-card.current-player {
            border-color: #4ecdc4;
            background: rgba(78, 205, 196, 0.2);
        }

        .player-name {
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 5px;
        }

        .player-role {
            font-size: 0.9em;
            color: #ccc;
        }

        .chat-container {
            height: 300px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            overflow-y: auto;
            margin-bottom: 15px;
            border: 1px solid #444;
        }

        .chat-message {
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }

        .message-sender {
            font-weight: bold;
            color: #FFD700;
        }

        .message-content {
            margin-left: 10px;
        }

        .system-message {
            background: rgba(78, 205, 196, 0.2);
            border-left: 3px solid #4ecdc4;
        }

        .system-message .message-sender {
            color: #4ecdc4;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid #444;
        }

        .chat-input input::placeholder {
            color: #aaa;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, #8B0000, #CD5C5C);
            color: #fff;
        }

        .btn:hover {
            background: linear-gradient(45deg, #CD5C5C, #8B0000);
            transform: translateY(-1px);
        }

        .btn-primary {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
        }

        .btn-primary:hover {
            background: linear-gradient(45deg, #FFA500, #FFD700);
        }

        .character-info {
            background: rgba(139, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #FFD700;
        }

        .character-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 10px;
        }

        .character-details {
            font-size: 0.9em;
            line-height: 1.4;
        }

        .secret-info {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #ff6b6b;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
        }

        .secret-title {
            color: #ff6b6b;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .evidence-list {
            list-style: none;
        }

        .evidence-item {
            background: rgba(78, 205, 196, 0.2);
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 8px;
            border-left: 3px solid #4ecdc4;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .evidence-item:hover {
            background: rgba(78, 205, 196, 0.3);
        }

        .voting-section {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #FFD700;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .vote-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .vote-button {
            padding: 15px;
            background: rgba(139, 0, 0, 0.3);
            border: 2px solid #8B0000;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .vote-button:hover {
            background: rgba(139, 0, 0, 0.5);
            transform: scale(1.05);
        }

        .vote-button.selected {
            background: rgba(255, 215, 0, 0.3);
            border-color: #FFD700;
            color: #FFD700;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a1a, #2d1810);
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            border: 3px solid #FFD700;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
        }

        .modal h2 {
            color: #FFD700;
            margin-bottom: 20px;
            text-align: center;
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }

        .close:hover {
            color: #fff;
        }

        .setup-screen {
            text-align: center;
            max-width: 500px;
            margin: 0 auto;
        }

        .setup-screen h2 {
            color: #FFD700;
            margin-bottom: 20px;
        }

        .setup-screen input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 1.1em;
            border: 2px solid #444;
        }

        .setup-screen input::placeholder {
            color: #aaa;
        }

        .character-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .character-option {
            background: rgba(139, 0, 0, 0.2);
            border: 2px solid #8B0000;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .character-option:hover {
            background: rgba(139, 0, 0, 0.4);
            transform: translateY(-2px);
        }

        .character-option.selected {
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.2);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .game-status {
                flex-direction: column;
                gap: 10px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .chat-container {
                height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”»é¢ -->
        <div id="setupScreen" class="setup-screen">
            <div class="header">
                <h1>ğŸšï¸ ã‚¯ãƒªãƒ ã‚¾ãƒ³ãƒ»ãƒãƒ³ã‚·ãƒ§ãƒ³æ®ºäººäº‹ä»¶ ğŸ”</h1>
                <p>å±±å¥¥ã®è±ªè¯åˆ¥è˜ã§èµ·ããŸè¬ã®æ®ºäººäº‹ä»¶...</p>
            </div>
            
            <h2>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
            <input type="text" id="playerNameInput" placeholder="ã‚ãªãŸã®åå‰" maxlength="20">
            
            <h2>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
            <div class="character-selection" id="characterSelection">
                <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠè‚¢ãŒå‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>
            
            <button class="btn btn-primary" onclick="startGame()">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ç”»é¢ -->
        <div id="gameScreen" style="display: none;">
            <div class="header">
                <h1>ğŸšï¸ ã‚¯ãƒªãƒ ã‚¾ãƒ³ãƒ»ãƒãƒ³ã‚·ãƒ§ãƒ³æ®ºäººäº‹ä»¶ ğŸ”</h1>
            </div>

            <div class="game-status">
                <div class="timer" id="timer">05:00</div>
                <div class="phase" id="currentPhase">æº–å‚™ãƒ•ã‚§ãƒ¼ã‚º</div>
                <button class="btn" onclick="nextPhase()">æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚º</button>
            </div>

            <div class="main-content">
                <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸€è¦§ -->
                <div class="players-panel">
                    <h3>ğŸ­ å‚åŠ è€…</h3>
                    <div id="playersList"></div>
                </div>

                <!-- ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ -->
                <div class="center-panel">
                    <div class="chat-container" id="chatContainer">
                        <!-- ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ -->
                    </div>
                    <div class="chat-input">
                        <input type="text" id="messageInput" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..." maxlength="200">
                        <button class="btn" onclick="sendMessage()">é€ä¿¡</button>
                    </div>
                </div>

                <!-- æƒ…å ±ãƒ‘ãƒãƒ« -->
                <div class="info-panel">
                    <h3>ğŸ“‹ ã‚ãªãŸã®æƒ…å ±</h3>
                    <div id="characterInfo"></div>
                    
                    <h3>ğŸ” è¨¼æ‹ å“</h3>
                    <ul id="evidenceList" class="evidence-list"></ul>
                </div>
            </div>

            <!-- æŠ•ç¥¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div id="votingSection" class="voting-section" style="display: none;">
                <h3>ğŸ—³ï¸ çŠ¯äººæŠ•ç¥¨</h3>
                <p>èª°ãŒçŠ¯äººã ã¨æ€ã„ã¾ã™ã‹ï¼Ÿ</p>
                <div id="voteGrid" class="vote-grid"></div>
                <button class="btn btn-primary" onclick="submitVote()" style="margin-top: 15px;">æŠ•ç¥¨ã™ã‚‹</button>
            </div>
        </div>

        <!-- çµæœãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="resultModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <h2>ğŸŠ ã‚²ãƒ¼ãƒ çµæœ</h2>
                <div id="resultContent"></div>
                <button class="btn btn-primary" onclick="restartGame()" style="margin-top: 20px;">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
            </div>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let gameState = {
            currentPhase: 0,
            timeLeft: 300,
            players: [],
            currentPlayer: null,
            selectedCharacter: null,
            votes: {},
            messages: [],
            evidence: [],
            isVotingPhase: false
        };

        // ãƒ•ã‚§ãƒ¼ã‚ºè¨­å®š
        const phases = [
            { name: "æº–å‚™ãƒ•ã‚§ãƒ¼ã‚º", duration: 300 },
            { name: "æƒ…å ±åé›†", duration: 600 },
            { name: "ç¬¬1å›è­°è«–", duration: 900 },
            { name: "å¯†è«‡ã‚¿ã‚¤ãƒ ", duration: 300 },
            { name: "æœ€çµ‚è­°è«–", duration: 900 },
            { name: "æŠ•ç¥¨ãƒ•ã‚§ãƒ¼ã‚º", duration: 300 },
            { name: "çµæœç™ºè¡¨", duration: 0 }
        ];

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š
        const characters = [
            {
                id: 'son',
                name: 'æ¯å­ - å¤§å­¦ç”Ÿã®ã‚¿ã‚±ã‚·',
                role: 'è¢«å®³è€…ã®æ¯å­',
                description: 'çˆ¶è¦ªã®éºç”£ç›¸ç¶šã«æ‚©ã‚€å¤§å­¦ç”Ÿã€‚æœ€è¿‘çˆ¶è¦ªã¨é‡‘éŠ­ãƒˆãƒ©ãƒ–ãƒ«ãŒã‚ã£ãŸã€‚',
                secret: 'å®Ÿã¯å¤šé¡ã®å€Ÿé‡‘ãŒã‚ã‚Šã€çˆ¶è¦ªã«æ³£ãã¤ã„ã¦ã„ãŸã€‚',
                alibi: 'äº‹ä»¶å½“æ™‚ã€è‡ªå®¤ã§å‹‰å¼·ã—ã¦ã„ãŸã€‚',
                isCriminal: false
            },
            {
                id: 'secretary',
                name: 'ç§˜æ›¸ - ç¾å’²',
                role: 'è¢«å®³è€…ã®ç§˜æ›¸',
                description: '10å¹´é–“ä»•ãˆã‚‹æœ‰èƒ½ãªç§˜æ›¸ã€‚è¢«å®³è€…ã®å…¨ã¦ã®ç§˜å¯†ã‚’çŸ¥ã£ã¦ã„ã‚‹ã€‚',
                secret: 'è¢«å®³è€…ã®ä¸æ­£ãªå–å¼•ã‚’çŸ¥ã£ã¦ãŠã‚Šã€ãã‚Œã‚’ç†ç”±ã«æ˜‡çµ¦ã‚’è¦æ±‚ã—ã¦ã„ãŸã€‚',
                alibi: 'äº‹ä»¶å½“æ™‚ã€æ›¸é¡æ•´ç†ã‚’ã—ã¦ã„ãŸã€‚',
                isCriminal: true // çœŸçŠ¯äºº
            },
            {
                id: 'chef',
                name: 'æ–™ç†äºº - ç”°ä¸­',
                role: 'å°‚å±æ–™ç†äºº',
                description: 'å®¶æ—ã®åŒ»ç™‚è²»ã®ãŸã‚åƒã„ã¦ã„ã‚‹ãƒ™ãƒ†ãƒ©ãƒ³æ–™ç†äººã€‚',
                secret: 'å®Ÿã¯æ–™ç†ã«ç¡çœ è–¬ã‚’æ··ãœãŸã“ã¨ãŒã‚ã‚‹ï¼ˆä»Šå›ã®äº‹ä»¶ã¨ã¯ç„¡é–¢ä¿‚ï¼‰ã€‚',
                alibi: 'äº‹ä»¶å½“æ™‚ã€ã‚­ãƒƒãƒãƒ³ã§ç¿Œæ—¥ã®æº–å‚™ã‚’ã—ã¦ã„ãŸã€‚',
                isCriminal: false
            },
            {
                id: 'maid',
                name: 'ãƒ¡ã‚¤ãƒ‰ - èŠ±å­',
                role: 'æ–°äººãƒ¡ã‚¤ãƒ‰',
                description: '3ãƒ¶æœˆå‰ã‹ã‚‰åƒãå§‹ã‚ãŸæ–°äººã€‚éå»ã«å•é¡Œã‚’èµ·ã“ã—ã¦å‰è·ã‚’è¾ã‚ãŸã€‚',
                secret: 'å‰è·ã§çªƒç›—ã®ç–‘ã„ã‚’ã‹ã‘ã‚‰ã‚Œã¦è¾ã‚ãŸï¼ˆå®Ÿéš›ã¯æ¿¡ã‚Œè¡£ï¼‰ã€‚',
                alibi: 'äº‹ä»¶å½“æ™‚ã€2éšã®æƒé™¤ã‚’ã—ã¦ã„ãŸã€‚',
                isCriminal: false
            },
            {
                id: 'doctor',
                name: 'åŒ»å¸« - ä½è—¤å…ˆç”Ÿ',
                role: 'å®¶æ—ã®å‹äºº',
                description: 'è¢«å®³è€…å®¶æ—ã®å¤ã„å‹äººã§ã€å®šæœŸçš„ã«å¥åº·è¨ºæ–­ã‚’ã—ã¦ã„ã‚‹åŒ»å¸«ã€‚',
                secret: 'å®Ÿã¯å¤šé¡ã®å€Ÿé‡‘ãŒã‚ã‚Šã€è¢«å®³è€…ã«ãŠé‡‘ã‚’å€Ÿã‚Šã¦ã„ãŸã€‚',
                alibi: 'äº‹ä»¶å½“æ™‚ã€åº­ã§é›»è©±ã‚’ã—ã¦ã„ãŸã€‚',
                isCriminal: false
            },
            {
                id: 'lawyer',
                name: 'å¼è­·å£« - éˆ´æœ¨',
                role: 'é¡§å•å¼è­·å£«',
                description: 'è¢«å®³è€…ã®éºè¨€æ›¸ä½œæˆã«é–¢ã‚ã£ã¦ã„ã‚‹å¼è­·å£«ã€‚',
                secret: 'éºè¨€æ›¸ã®å†…å®¹ã‚’äº‹å‰ã«æ¯å­ã«æ•™ãˆã¦ã—ã¾ã£ãŸã€‚',
                alibi: 'äº‹ä»¶å½“æ™‚ã€æ›¸æ–ã§éºè¨€æ›¸ã®æœ€çµ‚ç¢ºèªã‚’ã—ã¦ã„ãŸã€‚',
                isCriminal: false
            }
        ];

        // è¨¼æ‹ å“
        const evidenceItems = [
            'æ¯’å…¥ã‚Šãƒ–ãƒ©ãƒ³ãƒ‡ãƒ¼ã‚°ãƒ©ã‚¹ - è¢«å®³è€…ãŒé£²ã‚“ã§ã„ãŸã‚°ãƒ©ã‚¹ã‹ã‚‰æ¯’ç‰©æ¤œå‡º',
            'ç ´ã‹ã‚ŒãŸéºè¨€æ›¸ - æ›¸æ–ã§ç™ºè¦‹ã•ã‚ŒãŸéºè¨€æ›¸ã®æ–­ç‰‡',
            'è¢«å®³è€…ã®æ—¥è¨˜ - æœ€è¿‘ã®äººé–“é–¢ä¿‚ã«ã¤ã„ã¦è¨˜è¿°',
            'ä¸å¯©ãªé›»è©±è¨˜éŒ² - äº‹ä»¶å‰æ—¥ã®è¬ã®é›»è©±',
            'ç©ºã®è–¬ç“¶ - æ›¸æ–ã®éš…ã§ç™ºè¦‹ã•ã‚ŒãŸè–¬å“ã®å®¹å™¨',
            'åˆ¥è˜ã®è¦‹å–ã‚Šå›³ - ç§˜å¯†ã®é€šè·¯ãŒè¨˜ã•ã‚Œã¦ã„ã‚‹'
        ];

        let timer;

        // åˆæœŸåŒ–
        function initGame() {
            displayCharacterSelection();
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠè¡¨ç¤º
        function displayCharacterSelection() {
            const container = document.getElementById('characterSelection');
            container.innerHTML = '';
            
            characters.forEach(character => {
                const div = document.createElement('div');
                div.className = 'character-option';
                div.onclick = () => selectCharacter(character.id);
                div.innerHTML = `
                    <div class="character-name">${character.name}</div>
                    <div class="character-details">${character.description}</div>
                `;
                container.appendChild(div);
            });
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠ
        function selectCharacter(characterId) {
            // å‰ã®é¸æŠã‚’è§£é™¤
            document.querySelectorAll('.character-option').forEach(el => {
                el.classList.remove('selected');
            });
            
            // æ–°ã—ã„é¸æŠã‚’é©ç”¨
            event.target.closest('.character-option').classList.add('selected');
            gameState.selectedCharacter = characterId;
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            const playerName = document.getElementById('playerNameInput').value.trim();
            if (!playerName) {
                alert('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (!gameState.selectedCharacter) {
                alert('ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆæœŸåŒ–
            gameState.currentPlayer = {
                name: playerName,
                characterId: gameState.selectedCharacter
            };

            // NPCãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ 
            initializePlayers();
            
            // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            
            // ã‚²ãƒ¼ãƒ é–‹å§‹
            updateDisplay();
            startTimer();
            addSystemMessage('ã‚²ãƒ¼ãƒ é–‹å§‹ï¼åµã«ã‚ˆã‚Šå¤–éƒ¨ã¨é®æ–­ã•ã‚ŒãŸåˆ¥è˜ã§æ®ºäººäº‹ä»¶ãŒç™ºç”Ÿã—ã¾ã—ãŸ...');
            addSystemMessage('è¢«å®³è€…ï¼šå¯Œè±ªã®çˆ¶è¦ªï¼ˆåˆ¥è˜ã®ä¸»äººï¼‰');
            addSystemMessage('æ­»å› ï¼šæ¯’æ®º');
            addSystemMessage('ç™ºè¦‹å ´æ‰€ï¼šæ›¸æ–');
            addSystemMessage('ç™ºè¦‹æ™‚åˆ»ï¼šå¤œ10æ™‚é ƒ');
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆæœŸåŒ–
        function initializePlayers() {
            gameState.players = [];
            
            // ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ 
            const playerCharacter = characters.find(c => c.id === gameState.selectedCharacter);
            gameState.players.push({
                name: gameState.currentPlayer.name,
                character: playerCharacter,
                isCurrentPlayer: true
            });

            // ä»–ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’NPCã¨ã—ã¦è¿½åŠ 
            characters.forEach(character => {
                if (character.id !== gameState.selectedCharacter) {
                    gameState.players.push({
                        name: character.name.split(' - ')[1] || character.name,
                        character: character,
                        isCurrentPlayer: false
                    });
                }
            });

            // è¨¼æ‹ å“åˆæœŸåŒ–
            gameState.evidence = evidenceItems.slice(0, 3); // æœ€åˆã¯3ã¤ã®è¨¼æ‹ 
        }

        // è¡¨ç¤ºæ›´æ–°
        function updateDisplay() {
            updatePlayersList();
            updateCharacterInfo();
            updateEvidenceList();
            updatePhaseDisplay();
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆæ›´æ–°
        function updatePlayersList() {
            const container = document.getElementById('playersList');
            container.innerHTML = '';
            
            gameState.players.forEach(player => {
                const div = document.createElement('div');
                div.className = `player-card ${player.isCurrentPlayer ? 'current-player' : ''}`;
                div.innerHTML = `
                    <div class="player-name">${player.name}</div>
                    <div class="player-role">${player.character.role}</div>
                `;
                container.appendChild(div);
            });
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æƒ…å ±æ›´æ–°
        function updateCharacterInfo() {
            const container = document.getElementById('characterInfo');
            const currentPlayerData = gameState.players.find(p => p.isCurrentPlayer);
            
            if (currentPlayerData) {
                const character = currentPlayerData.character;
                container.innerHTML = `
                    <div class="character-info">
                        <div class="character-name">${character.name}</div>
                        <div class="character-details">
                            <p><strong>å½¹è·ï¼š</strong>${character.role}</p>
                            <p><strong>è©³ç´°ï¼š</strong>${character.description}</p>
                            <p><strong>ã‚¢ãƒªãƒã‚¤ï¼š</strong>${character.alibi}</p>
                        </div>
                        <div class="secret-info">
                            <div class="secret-title">ğŸ¤« ã‚ãªãŸã®ç§˜å¯†</div>
                            <div>${character.secret}</div>
                        </div>
                    </div>
                `;
            }
        }

        // è¨¼æ‹ å“ãƒªã‚¹ãƒˆæ›´æ–°
        function updateEvidenceList() {
            const container = document.getElementById('evidenceList');
            container.innerHTML = '';
            
            gameState.evidence.forEach((evidence, index) => {
                const li = document.createElement('li');
                li.className = 'evidence-item';
                li.textContent = evidence;
                li.onclick = () => shareEvidence(index);
                container.appendChild(li);
            });
        }

        // ãƒ•ã‚§ãƒ¼ã‚ºè¡¨ç¤ºæ›´æ–°
        function updatePhaseDisplay() {
            document.getElementById('currentPhase').textContent = phases[gameState.currentPhase].name;
            
            // æŠ•ç¥¨ãƒ•ã‚§ãƒ¼ã‚ºã®è¡¨ç¤ºåˆ¶å¾¡
            if (gameState.currentPhase === 5) {
                showVotingSection();
            } else {
                document.getElementById('votingSection').style.display = 'none';
            }
        }

        // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
        function startTimer() {
            gameState.timeLeft = phases[gameState.currentPhase].duration;
            updateTimer();
            
            timer = setInterval(() => {
                gameState.timeLeft--;
                updateTimer();
                
                if (gameState.timeLeft <= 0) {
                    clearInterval(timer);
                    if (gameState.currentPhase < phases.length - 1) {
                        nextPhase();
                    }
                }
            }, 1000);
        }

        // ã‚¿ã‚¤ãƒãƒ¼æ›´æ–°
        function updateTimer() {
            const minutes = Math.floor(gameState.timeLeft / 60);
            const seconds = gameState.timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚º
        function nextPhase() {
            clearInterval(timer);
            
            if (gameState.currentPhase < phases.length - 1) {
                gameState.currentPhase++;
                
                // ãƒ•ã‚§ãƒ¼ã‚ºå¤‰æ›´æ™‚ã®å‡¦ç†
                switch (gameState.currentPhase) {
                    case 1:
                        addSystemMessage('æƒ…å ±åé›†ãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹ï¼å„è‡ªã®æƒ…å ±ã‚’å…±æœ‰ã—ã¾ã—ã‚‡ã†ã€‚');
                        addMoreEvidence();
                        break;
                    case 2:
                        addSystemMessage('ç¬¬1å›è­°è«–é–‹å§‹ï¼ç–‘ã‚ã—ã„ç‚¹ã«ã¤ã„ã¦è©±ã—åˆã„ã¾ã—ã‚‡ã†ã€‚');
                        simulateNPCMessages();
                        break;
                    case 3:
                        addSystemMessage('å¯†è«‡ã‚¿ã‚¤ãƒ ï¼å€‹åˆ¥ã«ç›¸è«‡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚');
                        break;
                    case 4:
                        addSystemMessage('æœ€çµ‚è­°è«–ï¼ã“ã‚Œã¾ã§ã®æƒ…å ±ã‚’æ•´ç†ã—ã¦çŠ¯äººã‚’ç‰¹å®šã—ã¾ã—ã‚‡ã†ã€‚');
                        addMoreEvidence();
                        break;
                    case 5:
                        addSystemMessage('æŠ•ç¥¨ãƒ•ã‚§ãƒ¼ã‚ºï¼çŠ¯äººã ã¨æ€ã†äººã«æŠ•ç¥¨ã—ã¦ãã ã•ã„ã€‚');
                        break;
                    case 6:
                        showResults();
                        return;
                }
                
                updateDisplay();
                if (phases[gameState.currentPhase].duration > 0) {
                    startTimer();
                }
            }
        }

        // è¿½åŠ è¨¼æ‹ å“
        function addMoreEvidence() {
            if (gameState.evidence.length < evidenceItems.length) {
                const newEvidence = evidenceItems[gameState.evidence.length];
                gameState.evidence.push(newEvidence);
                updateEvidenceList();
                addSystemMessage(`æ–°ã—ã„è¨¼æ‹ ãŒç™ºè¦‹ã•ã‚Œã¾ã—ãŸï¼š${newEvidence}`);
            }
        }

        // NPCãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        function simulateNPCMessages() {
            const npcMessages = [
                { sender: 'ç”°ä¸­ï¼ˆæ–™ç†äººï¼‰', message: 'ç§ã¯äº‹ä»¶å½“æ™‚ã‚­ãƒƒãƒãƒ³ã«ã„ã¾ã—ãŸã€‚èª°ã‚‚è¦‹ã¦ã„ã¾ã›ã‚“ãŒ...' },
                { sender: 'èŠ±å­ï¼ˆãƒ¡ã‚¤ãƒ‰ï¼‰', message: '2éšã§æƒé™¤ã‚’ã—ã¦ã„ã¦ã€ä½•ã‚‚è¦‹ã¦ã„ã¾ã›ã‚“ã€‚' },
                { sender: 'ä½è—¤å…ˆç”Ÿ', message: 'åº­ã§é›»è©±ã‚’ã—ã¦ã„ã¾ã—ãŸã€‚é‡è¦ãªè©±ã ã£ãŸã®ã§...' },
                { sender: 'ç¾å’²ï¼ˆç§˜æ›¸ï¼‰', message: 'æ›¸é¡æ•´ç†ã‚’ã—ã¦ã„ã¾ã—ãŸã€‚ã„ã¤ã‚‚é€šã‚Šã®ä½œæ¥­ã§ã™ã€‚' }
            ];
            
            let delay = 2000;
            npcMessages.forEach((msg, index) => {
                setTimeout(() => {
                    addMessage(msg.sender, msg.message);
                }, delay * (index + 1));
            });
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message) {
                addMessage(gameState.currentPlayer.name, message);
                input.value = '';
                
                // NPCã®ç°¡å˜ãªåå¿œã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                setTimeout(() => {
                    simulateNPCResponse(message);
                }, 1000 + Math.random() * 2000);
            }
        }

        // ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        });

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ 
        function addMessage(sender, message) {
            gameState.messages.push({ sender, message, timestamp: Date.now() });
            
            const container = document.getElementById('chatContainer');
            const div = document.createElement('div');
            div.className = 'chat-message';
            div.innerHTML = `
                <span class="message-sender">${sender}:</span>
                <span class="message-content">${message}</span>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        // ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ 
        function addSystemMessage(message) {
            const container = document.getElementById('chatContainer');
            const div = document.createElement('div');
            div.className = 'chat-message system-message';
            div.innerHTML = `
                <span class="message-sender">ğŸ­ ã‚·ã‚¹ãƒ†ãƒ :</span>
                <span class="message-content">${message}</span>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        // NPCã®åå¿œã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
        function simulateNPCResponse(playerMessage) {
            const responses = [
                { name: 'ç”°ä¸­ï¼ˆæ–™ç†äººï¼‰', responses: ['ãã†ã§ã™ã­...', 'æ°—ã«ãªã‚Šã¾ã™ã­', 'ç§ã‚‚åŒæ„Ÿã§ã™'] },
                { name: 'èŠ±å­ï¼ˆãƒ¡ã‚¤ãƒ‰ï¼‰', responses: ['ãˆã£ã¨...', 'ãã†ãªã‚“ã§ã™ã‹ï¼Ÿ', 'çŸ¥ã‚Šã¾ã›ã‚“ã§ã—ãŸ'] },
                { name: 'ä½è—¤å…ˆç”Ÿ', responses: ['ãªã‚‹ã»ã©', 'ãã‚Œã¯é‡è¦ã§ã™ã­', 'ç¢ºã‹ã«'] },
                { name: 'ç¾å’²ï¼ˆç§˜æ›¸ï¼‰', responses: ['ãã‚“ãªã“ã¨ã¯...', 'ã©ã†ã§ã—ã‚‡ã†ã‹', 'ç§ã¯é•ã†ã¨æ€ã„ã¾ã™'] }
            ];
            
            const randomNPC = responses[Math.floor(Math.random() * responses.length)];
            const randomResponse = randomNPC.responses[Math.floor(Math.random() * randomNPC.responses.length)];
            
            addMessage(randomNPC.name, randomResponse);
        }

        // è¨¼æ‹ å“å…±æœ‰
        function shareEvidence(index) {
            const evidence = gameState.evidence[index];
            addMessage(gameState.currentPlayer.name, `è¨¼æ‹ å“ã‚’æç¤ºï¼š${evidence}`);
        }

        // æŠ•ç¥¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤º
        function showVotingSection() {
            document.getElementById('votingSection').style.display = 'block';
            
            const voteGrid = document.getElementById('voteGrid');
            voteGrid.innerHTML = '';
            
            gameState.players.forEach(player => {
                if (!player.isCurrentPlayer) {
                    const button = document.createElement('div');
                    button.className = 'vote-button';
                    button.textContent = player.name;
                    button.onclick = () => selectVote(player.name);
                    voteGrid.appendChild(button);
                }
            });
        }

        // æŠ•ç¥¨é¸æŠ
        function selectVote(playerName) {
            document.querySelectorAll('.vote-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
            gameState.selectedVote = playerName;
        }

        // æŠ•ç¥¨æå‡º
        function submitVote() {
            if (!gameState.selectedVote) {
                alert('æŠ•ç¥¨ã™ã‚‹ç›¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            gameState.votes[gameState.currentPlayer.name] = gameState.selectedVote;
            addSystemMessage(`${gameState.currentPlayer.name}ãŒæŠ•ç¥¨ã—ã¾ã—ãŸ`);
            
            // NPCã®æŠ•ç¥¨ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            simulateNPCVotes();
            
            setTimeout(() => {
                nextPhase();
            }, 2000);
        }

        // NPCã®æŠ•ç¥¨ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
        function simulateNPCVotes() {
            const npcs = gameState.players.filter(p => !p.isCurrentPlayer);
            const votableTargets = gameState.players.map(p => p.name);
            
            npcs.forEach(npc => {
                const possibleTargets = votableTargets.filter(name => name !== npc.name);
                const randomTarget = possibleTargets[Math.floor(Math.random() * possibleTargets.length)];
                gameState.votes[npc.name] = randomTarget;
            });
        }

        // çµæœè¡¨ç¤º
        function showResults() {
            clearInterval(timer);
            
            // æŠ•ç¥¨çµæœã®é›†è¨ˆ
            const voteCount = {};
            Object.values(gameState.votes).forEach(vote => {
                voteCount[vote] = (voteCount[vote] || 0) + 1;
            });
            
            // æœ€å¤šå¾—ç¥¨è€…ã‚’æ±ºå®š
            let maxVotes = 0;
            let suspectedCriminal = '';
            Object.entries(voteCount).forEach(([name, votes]) => {
                if (votes > maxVotes) {
                    maxVotes = votes;
                    suspectedCriminal = name;
                }
            });
            
            // çœŸçŠ¯äººã‚’ç‰¹å®š
            const actualCriminal = gameState.players.find(p => p.character.isCriminal);
            const isCorrect = suspectedCriminal === actualCriminal.name;
            
            // çµæœè¡¨ç¤º
            let resultHTML = `
                <h3>ğŸ—³ï¸ æŠ•ç¥¨çµæœ</h3>
                <div style="margin: 20px 0;">
            `;
            
            Object.entries(voteCount).forEach(([name, votes]) => {
                resultHTML += `<p>${name}: ${votes}ç¥¨</p>`;
            });
            
            resultHTML += `</div>
                <h3>ğŸ­ çœŸå®Ÿã®å…¬é–‹</h3>
                <div style="margin: 20px 0;">
                    <p><strong>çœŸçŠ¯äººï¼š</strong>${actualCriminal.name}</p>
                    <p><strong>å‹•æ©Ÿï¼š</strong>${actualCriminal.character.secret}</p>
                    <p><strong>æ¨ç†çµæœï¼š</strong>${isCorrect ? 'ğŸ‰ æ­£è§£ï¼' : 'âŒ æ®‹å¿µ...'}</p>
                </div>
                
                <h3>ğŸ“š å„ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®çœŸå®Ÿ</h3>
                <div style="margin: 20px 0;">
            `;
            
            gameState.players.forEach(player => {
                resultHTML += `
                    <div style="margin: 10px 0; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 5px;">
                        <strong>${player.name} (${player.character.role})</strong><br>
                        ç§˜å¯†: ${player.character.secret}
                    </div>
                `;
            });
            
            resultHTML += '</div>';
            
            document.getElementById('resultContent').innerHTML = resultHTML;
            document.getElementById('resultModal').style.display = 'flex';
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeModal() {
            document.getElementById('resultModal').style.display = 'none';
        }

        // ã‚²ãƒ¼ãƒ ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ
        function restartGame() {
            // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            gameState = {
                currentPhase: 0,
                timeLeft: 300,
                players: [],
                currentPlayer: null,
                selectedCharacter: null,
                votes: {},
                messages: [],
                evidence: [],
                isVotingPhase: false
            };
            
            // ç”»é¢ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('playerNameInput').value = '';
            document.getElementById('messageInput').value = '';
            document.getElementById('chatContainer').innerHTML = '';
            document.querySelectorAll('.character-option').forEach(el => {
                el.classList.remove('selected');
            });
            
            // ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”»é¢ã«æˆ»ã‚‹
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'block';
            closeModal();
            
            // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠã‚’å†è¡¨ç¤º
            displayCharacterSelection();
        }

        // åˆæœŸåŒ–å®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            initGame();
        });
